FROM node

RUN apt-get update \
    && apt-get install -y openssl

ARG target_dir="/etc/requester"

ENV OPENSSL_DIR=${target_dir}

RUN mkdir -p $target_dir

COPY request_openssl.cnf $target_dir/openssl.cnf

WORKDIR $target_dir 
RUN mkdir certs private
RUN chmod 700 private

WORKDIR /usr/src/app
COPY request_server.js ./server.js
COPY request_package.json ./package.json

RUN npm install

EXPOSE 8000

ENV PORT=8000

CMD [ "node", "server.js" ]